<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/offcanvas.css" />
    <link rel="stylesheet" href="../css/datatables.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.1.7/css/fixedHeader.dataTables.min.css" />

    <title>APE - Input Options</title>
  </head>
  <body>
    <nav id="navigation" class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
      <span class="navbar-brand mr-auto mr-lg-0" href="#"
        ><b>A</b>ssisted <b>P</b>ricing <b>E</b>nvironment</span
      >
      <button
        class="navbar-toggler p-0 border-0"
        type="button"
        data-toggle="offcanvas"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="navbar-collapse offcanvas-collapse"
        id="navbarsExampleDefault"
      >
        <ul class="navbar-nav mr-auto">
          <li class="nav-item">
            <a class="nav-link" href="../index.html">Summary</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./overview.html">Detailed Variance Analysis</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="./pricelistfinal.html"
              >Price List Final</a
            >
            <li class="nav-item"><a class="nav-link" href="./GeneralInformation.html">Input - General Information</a></li>
          <li class="nav-item">
            <a class="nav-link" href="./TEWU.html">Input - Vehicles</a>
          </li>
          </li>
          <li class="nav-item active">
            <a class="nav-link" href="./alloptions.html"
              >Input - Options <span class="sr-only">(current)</span></a
            >
          </li>
        </ul>
      </div>
    </nav>
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <!-- z tego można pomyśleć czy nie zrobić <header> -->
          <h1>Input - Options</h1>
          <p class="text-monospace">
            <mark>Table creation date:</mark>
            <time datetime="2020-05-20">20.05.2020</time>
          </p>
          <p class="text-monospace">
            <mark>VOG reference date:</mark>
            <time datetime="2020-05-10">10.05.2020</time>
          </p>
          <!-- </header> -->
        </div>
      </div>

      <div class="row">
        <div class="col">
          <form action="">
            <div class="row">
              <div class="form-group col-12 col-sm-6 col-md-3">
                <!-- TODO dodać value do wszystkich selectów -->
                <label for="country">Country</label>
                <select class="form-control" id="country">
                  <option>Switzerland</option>
                  <option>Ireland</option>
                  <option>Scotland</option>
                  <option>Portugal</option>
                  <option>Poland</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="countryGroup">Country Group</label>
                <select class="form-control" id="countryGroup">
                  <option>CA</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="carline">Carline</label>
                <select class="form-control" id="carline">
                  <option>Mokka</option>
                  <option>Astra</option>
                  <option>Insignia</option>
                  <option>Corsa</option>
                  <option>Crossland</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="vehicleBrand">Vehicle Brand</label>
                <select class="form-control" id="vehicleBrand">
                  <option>0: Opel</option>
                  <option>Vauxhall</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="modelYear">Model Year</label>
                <select class="form-control" id="modelYear">
                  <option>21.0A</option>
                  <option>20.0</option>
                  <option>19.0</option>
                </select>
              </div>
            </div>
            <button id="submitButton" class="btn btn-primary">
              Submit
            </button>
          </form>
        </div>
      </div>

      <!-- <div class="row">
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Switzerland</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Mokka</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Opel</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">MY21.0</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary">1,1 CHF = 1 EUR</span>
        </div>
      </div> -->

      <div class="row">
        <div class="col">
          <div class="bd-callout">
            <div class="row">
              <div class="col">
                <div class="row">
                  <div class="col">
                    <!-- Button trigger modal -->
                    <!-- <button type="button" class="btn btn-outline-primary mb-4" data-toggle="modal" data-target="#exampleModalCenter">
                      Join tables
                    </button> -->

                    <!-- Modal -->
                    <!-- <div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLongTitle">Join tables</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                              <span aria-hidden="true">&times;</span>
                            </button>
                          </div>
                          <div class="modal-body">
                            To see joined tables as a single one, please select tables to merge
                            <form action="" class="mt-2">
                              <div class="d-flex flex-wrap justify-content-start">
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck1">
                                  <label class="form-check-label" for="defaultCheck1">
                                    CMO
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck2">
                                  <label class="form-check-label" for="defaultCheck2">
                                    LMO
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" checked id="defaultCheck3">
                                  <label class="form-check-label" for="defaultCheck3">
                                    Default MSRP
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck4">
                                  <label class="form-check-label" for="defaultCheck4">
                                    PDU
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck5">
                                  <label class="form-check-label" for="defaultCheck5">
                                    Mix
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" checked id="defaultCheck6">
                                  <label class="form-check-label" for="defaultCheck6">
                                    Cost
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" id="defaultCheck7">
                                  <label class="form-check-label" for="defaultCheck7">
                                    Contribution Margin %
                                  </label>
                                </div>
                                <div class="form-check mr-4">
                                  <input class="form-check-input" type="checkbox" value="" checked id="defaultCheck8">
                                  <label class="form-check-label" for="defaultCheck8">
                                    Contribution Margin EUR
                                  </label>
                                </div>
                              </div>
                            </form>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <button id="joinTableBtn" type="button" class="btn btn-primary"> Join</button>
                          </div>
                        </div>
                      </div>
                    </div> -->
                    <div class="tab-content" >
                      <div
                        class="tab-pane fade show active"
                        role="tabpanel"
                      >
                      <button type="button" class="btn btn-outline-primary mb-3" disabled>New</button>
                      <button type="button" class="btn btn-outline-primary mb-3" disabled>Edit</button>
                      <button type="button" class="btn btn-outline-primary mb-3" disabled>Delete</button>
                        <div class="table-responsive">
                          <table
                            id="options_prices"
                            class="table table-sm table-striped table-bordered"
                          >
                            <thead class="thead-light">
                              <tr>
                                <th colspan="8"></td>
                                <th colspan="8">CURRENT MY</td>
                                <th colspan="8">PREVIOUS MY</td>
                              </tr>
                              <tr>
                                <th colspan="8"></td>
                                <th colspan="2">MSRP</td>
                                <th colspan="1">Mix</td>
                                <th colspan="1">GSF</td>
                                <th colspan="1">GS / PDU</td>
                                <th colspan="1">Material Cost</td>
                                <th colspan="2">FFO RBCV</td>   
                                <th colspan="2">MSRP</td>
                                <th colspan="1">Mix</td>
                                <th colspan="1">GSF</td>
                                <th colspan="1">GS / PDU</td>
                                <th colspan="1">Material Cost</td>
                                <th colspan="2">FFO RBCV</td>                              
                              </tr>
                              <tr>
                                <th scope="col" class="yellow"><div><span>Selected FFO</span></div></th>
                                <th scope="col"><div><span>Option Code RPO</span></div></th>
                                <th scope="col"><div><span>Option Code LCDV</span></div></th>
                                <th scope="col"><div><span>Over Standart CMO</span></div></th>
                                <th scope="col"><div><span>Option Designation</span></div></th>
                                <th scope="col"><div><span>Trimline Code</span></div></th>
                                <th scope="col"><div><span>Trimline</span></div></th>
                                <th scope="col"><div><span>Aggregated Body Style</span></div></th>
                                <th scope="col" class="yellow"><div><span>in LC</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col" class="yellow"><div><span>%</span></div></th>
                                <th scope="col"><div><span>%</span></div></th>
                                <th scope="col" class="yellow"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>% of PDU</span></div></th>
                                <th scope="col"><div><span>in LC</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>%</span></div></th>
                                <th scope="col"><div><span>%</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>in Euro</span></div></th>
                                <th scope="col"><div><span>% of PDU</span></div></th>
                              </tr>
                            </thead>
                          </table>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>

                <!-- TODO dodać na bazie nav / tablist tabele ukrywane i pokazywane w zależności od wybranego selecta: https://getbootstrap.com/docs/4.5/components/navs/#javascript-behavior -->
              </div>
            </div>
          </div>
          <!-- <div id="joinTablesExample" class="table-responsive mt-5 d-none">
            <table class="table table-sm table-striped table-bordered">
              <thead class="thead-light">
                <tr>
                  <th spancol = 1><div>EUR</div></th>
                </tr>
                <tr>
                  <th scope="col"><div><span>Option Category</span></div></th>
                  <th scope="col"><div><span>Option Code</span></div></th>
                  <th scope="col"><div><span>Family</span></div></th>
                  <th scope="col"><div><span>Option Description</span></div></th>
                  <th scope="col"><div><span>MB76 - Price</span></div></th>
                  <th scope="col"><div><span>MB76 - Cost</span></div></th>
                  <th scope="col"><div><span>MB76 - Cont. Margin</span></div></th>
                  <th scope="col"><div><span>MC76 - Price</span></div></th>
                  <th scope="col"><div><span>MC76 - Cost</span></div></th>
                  <th scope="col"><div><span>MC76 - Cont. Margin</span></div></th>
                  <th scope="col"><div><span>ME76 - Price</span></div></th>
                  <th scope="col"><div><span>ME76 - Cost</span></div></th>
                  <th scope="col"><div><span>ME76 - Cont. Margin</span></div></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><div><span>Accessories BEV</span></div></td>
                  <td><div><span>XZJG</span></div></td>
                  <td><div><span>'053</span></div></td>
                  <td><div><span>Cable Mode 2 base</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                </tr>
                <tr>
                  <td><div><span>Accessories BEV</span></div></td>
                  <td><div><span>XAZA</span></div></td>
                  <td><div><span>WLB</span></div></td>
                  <td><div><span>Cable Mode 2 enforced</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                </tr>
                <tr>
                  <td><div><span>Accessories BEV</span></div></td>
                  <td><div><span>XZJH</span></div></td>
                  <td><div><span>Q05</span></div></td>
                  <td><div><span>Cable Mode 3 - 1 Ph.</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                </tr>
                <tr>
                  <td><div><span>Accessories BEV</span></div></td>
                  <td><div><span>XZJi</span></div></td>
                  <td><div><span>Q06</span></div></td>
                  <td><div><span>Cable Mode 3 - 3 Ph. 16A</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                </tr>
                <tr>
                  <td><div><span>Accessories BEV</span></div></td>
                  <td><div><span>XZJJ</span></div></td>
                  <td><div><span>MAC</span></div></td>
                  <td><div><span>Cable Mode 3 - 3 Ph. 32A</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                  <td><div><span>200</span></div></td>
                  <td><div><span>70</span></div></td>
                  <td><div><span>100</span></div></td>
                </tr>
              </tbody>
            </table>
          </div> -->
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <!-- <script src="./js/jquery-3.5.1.slim.min.js"></script> -->
    <!-- TODO: do sprawdzenia wersje jQuery, bo coś DataTables świruje przy ładowaniu wersji jQuery Bootstrapa z dysku -->

    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/offcanvas.js"></script>
    <script src="../js/dataTable.jquery.js"></script>
    <script src="https://cdn.datatables.net/fixedheader/3.1.7/js/dataTables.fixedHeader.min.js"></script>
    <script>
      $(document).ready(function () {
        document.querySelector("#submitButton").addEventListener("click", (e) => {
          e.preventDefault();
          let r =
          {
            country: document.querySelector("#country").value,
            countryGroup: document.querySelector("#countryGroup").value,
            carline: document.querySelector("#carline").value,
            vehicleBrand: document.querySelector("#vehicleBrand").value,
            modelYear: document.querySelector("#modelYear").value
          };
    
          fetch('../InputOptions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(r)
          })
            .then(response => response.json())
            .then(data => {
                //price list final
                $('#options_prices').DataTable().clear().draw();
                $('#options_prices').DataTable().rows.add(data.options_prices);
                $('#options_prices').DataTable().columns.adjust().draw();
 
            });
        });
      });
  
        let r =
          {
            country: document.querySelector("#country").value,
            countryGroup: document.querySelector("#countryGroup").value,
            carline: document.querySelector("#carline").value,
            vehicleBrand: document.querySelector("#vehicleBrand").value,
            modelYear: document.querySelector("#modelYear").value
          };
  
        let tableData; // placeholder for ajax tables data
          
        $.ajax({
          headers: { 
            'Accept': 'application/json',
            'Content-Type': 'application/json' 
          },
          'type': 'POST',
          'url': "../InputOptions",
          'data': JSON.stringify(r),
          'dataType': 'json',
          success: function (data) {
            tableData = data,
            console.log('tableData', data);
            $("#options_prices").dataTable({
              data: data.options_prices,
            //   fixedHeader: {
            //   header: true,
            //   headerOffset: $('#navigation').outerHeight()
            // },
              columns: [
                { "data": "selectedFFO" },
                { "data": "optionCodeRPO" },
                { "data": "optionCodeLCDV" },
                { "data": "overStandartCMO" },
                { "data": "optionDescription" },
                { "data": "trimlineCode" },
                { "data": "trimlineName" },
                { "data": "aggregatedBodyStyle" },
                { "data": "msrpInLC_CurrMY" },
                { "data": "msrpInEuro_CurrMY" },
                { "data": "mixPercent_CurrMY" },
                { "data": "gsfPercent_CurrMY" },
                { "data": "gsDividedPDUinEuro_CurrMY" },
                { "data": "materialCostInEuro_CurrMY" },
                { "data": "foRbcvInEuro_CurrMY" },
                { "data": "foRbcvPercentOfPDU_CurrMY" },
                { "data": "msrpInLC_PrevMY" },
                { "data": "msrpInEuro_PrevMY" },
                { "data": "mixPercent_PrevMY" },
                { "data": "gsfPercent_PrevMY" },
                { "data": "gsDividedPDUinEuro_PrevMY" },
                { "data": "materialCostInEuro_PrevMY" },
                { "data": "foRbcvInEuro_PrevMY" },
                { "data": "foRbcvPercentOfPDU_PrevMY" },                
              ],
              "columnDefs": [
              { "render": $.fn.dataTable.render.number( '.', ','),
                "targets":[ 8,9,12,13,14,16,17,20,21,22 ]
              },
              {className: "yellow", "targets": [ 0,8,10,12 ] },
              ],
              error: function (error) {
                alert("Data Tables ERROR: " + error)
              }
            });
  },
          error: function (error) {
            alert("AJAX ERROR: " + error)
          },
        });
              
    </script>
    <!-- <script>
      $(document).ready(function () {
        $("#cmo").DataTable({
          fixedHeader: {
            header: true,
            headerOffset: $('#navigation').outerHeight()
        },
          ajax: "../data/rPT_AllOptions_CMO.json",
          columns: [
            { data: "Option Category" },
            { data: "Option Code" },
            { data: "Family" },
            { data: "Option Description" },
            { data: "MB76" },
            { data: "MC76" },
            { data: "ME76" },
            { data: "MJ76" },
            { data: "MS76" },
            { data: "MT76" },
            { data: "MU76" },
            { data: "MI76" },
            { data: "MD76" },
            { data: "MF76" },
            { data: "ML76" },
            { data: "MM76" },
            { data: "MN76" },
            { data: "MH76" },
          ],
          "columnDefs": [
    { "render": $.fn.dataTable.render.number( '.', ','),
                "targets":'_all'
              },
          ]
        });


      });
    </script> -->

    <!-- <script>
      var joinTableBtn = $("#joinTableBtn");
      var joinTableModal = $("#exampleModalCenter");
      var spinner = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>'

      function disableButton(btn) {
        btn.prop('disabled', true);
        btn.prepend(spinner);
      };
      function hideModal(modal) {
        modal.modal('hide');
      };
      function showJoinTable() {
        $("#joinTablesExample").removeClass("d-none");
      };
      function scrollTopAnimated() {
          var height = $(document).height(); 
          $("html, body").animate( 
              { scrollTop: height }, 1000); 
      };
      function enableButton(btn) {
        btn.prop('disabled', false);
        btn.find(".spinner-border").remove();
      }

      $("#joinTableBtn").click(function() {
        disableButton(joinTableBtn);
        setTimeout(function(){ hideModal(joinTableModal); scrollTopAnimated(); enableButton(joinTableBtn); }, 1000);
        showJoinTable();
      });
    </script> -->

    <!-- Option 2: jQuery, Popper.js, and Bootstrap JS
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" integrity="sha384-w1Q4orYjBQndcko6MimVbzY0tgp4pWB4lZ7lr30WKz0vr/aWKhXdBNmNb5D92v7s" crossorigin="anonymous"></script>
    -->
  </body>
</html>
