<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/styles.css" />
    <link rel="stylesheet" href="../css/offcanvas.css" />
    <link rel="stylesheet" href="../css/datatables.css" />

    <title>APE - Input General Information</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
      <span class="navbar-brand mr-auto mr-lg-0" href="#"
        ><b>A</b>ssisted <b>P</b>ricing <b>E</b>nvironment</span
      >
      <button
        class="navbar-toggler p-0 border-0"
        type="button"
        data-toggle="offcanvas"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div
        class="navbar-collapse offcanvas-collapse"
        id="navbarsExampleDefault"
      >
        <ul class="navbar-nav mr-auto">
          <li class="nav-item"><a class="nav-link" href="../index.html">Summary</a></li>
          <li class="nav-item"><a class="nav-link" href="./overview.html">Detailed Variance Analysis</a></li>
          <li class="nav-item"><a class="nav-link" href="./pricelistfinal.html">Price List Final</a></li>
          <li class="nav-item active"><a class="nav-link" href="./GeneralInformation.html">Input - General Information<span class="sr-only">(current)</span></a></li>
          <li class="nav-item"><a class="nav-link" href="./TEWU.html">Input - Vehicles</a></li>
          <li class="nav-item"><a class="nav-link" href="./alloptions.html">Input - Options</a></li>
        </ul>
      </div>
    </nav>
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <!-- z tego można pomyśleć czy nie zrobić <header> -->
          <h1>Input - General Information</h1>
          <p class="text-monospace">
            <mark>Table creation date:</mark>
            <time datetime="2020-05-20">20.05.2020</time>
          </p>
          <p class="text-monospace">
            <mark>VOG reference date:</mark>
            <time datetime="2020-05-10">10.05.2020</time>
          </p>
          <!-- </header> -->
        </div>
      </div>

      <div class="row">
        <div class="col">
          <form action="">
            <div class="row">
              <div class="form-group col-12 col-sm-6 col-md-3">
                <!-- TODO dodać value do wszystkich selectów -->
                <label for="country">Country</label>
                <select class="form-control" id="country">
                  <option>Switzerland</option>
                  <option>Greece</option>
                  <option>Scotland</option>
                  <option>Portugal</option>
                  <option>Poland</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <!-- TODO dodać value do wszystkich selectów -->
                <label for="countryGroup">Country Group</label>
                <select class="form-control" id="countryGroup">
                  <option>CA</option>
                  <option>B0</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="carline">Carline</label>
                <select class="form-control" id="carline">
                  <option>Mokka</option>
                  <option>Astra</option>
                  <option>Insignia</option>
                  <option>Corsa</option>
                  <option>Crossland</option>
                  <option>P2JO (1GJO)</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="vehicleBrand">Vehicle Brand</label>
                <select class="form-control" id="vehicleBrand">
                  <option>0: Opel</option>
                  <option>Vauxhall</option>
                  <option>G</option>
                </select>
              </div>
              <div class="form-group col-12 col-sm-6 col-md-3">
                <label for="modelYear">Model Year</label>
                <select class="form-control" id="modelYear">
                  <option>21.0A</option>
                  <option>20.0</option>
                  <option>19.0</option>
                  <option>C6</option>
                </select>
              </div>
            </div>
            <button id="submitButton" class="btn btn-primary">
              Submit
            </button>
          </form>
        </div>
      </div>

      <!-- <div class="row">
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Switzerland</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Mokka</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">Opel</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary bg-info">MY21.0</span>
        </div>
        <div class="col-auto">
          <span class="badge badge-primary">1,1 CHF = 1 EUR</span>
        </div>
      </div> -->

      <div class="row">
        <div class="col">
          <div class="bd-callout">
            <p>
              <div class="row">
                <div class="col-12 col-md-6">
                  <button type="button" class="btn btn-outline-primary mb-3" disabled>Edit</button>
                  <!-- <span class="badge badge-primary">Input General</span> -->
                  <div class="table-responsive">
                    <table class="table table-sm table-striped table-bordered" id = "inputgeneral">
                      <thead class="thead-light">
                        <tr>
                          <th scope="col"><div><span>Input General</span></div></th>
                          <th scope="col"><div><span>Value</span></div></th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
                <div class="col-12 col-md-6">
                  <!-- <span class="badge badge-primary">Other</span> -->
                  <button type="button" class="btn btn-outline-primary mb-3" disabled>Edit</button>
              
                  <div class="table-responsive">
                    <table
                      class="table table-sm table-striped table-bordered"
                      id = "inputother"
                    >
                      <thead class="thead-light">
                        <tr>
                          <th scope="col"><div><span>Input Other</span></div></th>
                          <th scope="col"><div><span>Value</span></div></th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
              </div>
            
          </div>
        </div>
      </div>
    </div>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: jQuery and Bootstrap Bundle (includes Popper) -->
    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <!-- <script src="./js/jquery-3.5.1.slim.min.js"></script> -->
    <!-- TODO: do sprawdzenia wersje jQuery, bo coś DataTables świruje przy ładowaniu wersji jQuery Bootstrapa z dysku -->
    <script src="https://cdn.datatables.net/select/1.3.2/js/dataTables.select.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.0/js/dataTables.buttons.min.js"></script>
    <script src="../js/bootstrap.bundle.min.js"></script>
    <script src="../js/offcanvas.js"></script>
    <script src="../js/dataTable.jquery.js"></script>
    <script>
      $(document).ready(function () {
        document.querySelector("#submitButton").addEventListener("click", (e) => {
          e.preventDefault();
          let r =
          {
            country: document.querySelector("#country").value,
            countryGroup: document.querySelector("#countryGroup").value,
            carline: document.querySelector("#carline").value,
            vehicleBrand: document.querySelector("#vehicleBrand").value,
            modelYear: document.querySelector("#modelYear").value
          };
    
          fetch('../InputGeneralInformation', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(r)
          })
            .then(response => response.json())
            .then(data => {
                //input_general
                $('#inputgeneral').DataTable().clear().draw();
                $('#inputgeneral').DataTable().rows.add(data.input_general);
                $('#inputgeneral').DataTable().columns.adjust().draw();
                
                //input_other
                $('#inputother').DataTable().clear().draw();
                $('#inputother').DataTable().rows.add(data.input_other);
                $('#inputother').DataTable().columns.adjust().draw();
 
            });
        });
      });
  
        let r =
          {
            country: document.querySelector("#country").value,
            countryGroup: document.querySelector("#countryGroup").value,
            carline: document.querySelector("#carline").value,
            vehicleBrand: document.querySelector("#vehicleBrand").value,
            modelYear: document.querySelector("#modelYear").value
          };
  
        let tableData; // placeholder for ajax tables data
          
        $.ajax({
          headers: { 
            'Accept': 'application/json',
            'Content-Type': 'application/json' 
          },
          'type': 'POST',
          'url': "../InputGeneralInformation",
          'data': JSON.stringify(r),
          'dataType': 'json',
          success: function (data) {
            tableData = data,
            console.log('tableData', data);
            $("#inputgeneral").dataTable({
              data: data.input_general,
              select: true,
              paging: false,
              ordering: false,
              bInfo: false,
              autoWidth: false,
              searching: false,
              columns: [
                { "data": "measureTypeSubcategory" },
                { "data": "value" },
              ],
              rows: [{selected: true}],
              error: function (error) {
                alert("Data Tables ERROR: " + error)
              }
            });
            $("#inputother").dataTable({
              data: data.input_other,
              paging: false,
              ordering: false,
              bInfo: false,
              autoWidth: false,
              searching: false,
              columns: [
                { "data": "measureTypeSubcategory" },
                { "data": "value" },
              ],
              error: function (error) {
                alert("Data Tables ERROR: " + error)
              }
            });
  },

          error: function (error) {
            alert("AJAX ERROR: " + error)
          },
        });
              
    </script>

  </body>
</html>
